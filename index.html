<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SYNTHETIC MOTIONS // IMMERSIVE</title>

  <style>
    :root {
      --bg: #080808;
      --text-main: #e4e4e4;
      --mono: "Aptos", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      --display: "Aptos", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      --motion-fast: 0.3s;
      --motion-mid: 0.65s;
      --motion-slow: 1.05s;
      --motion-ease: cubic-bezier(0.22, 1, 0.36, 1);
    }

    body {
      margin: 0;
      background-color: var(--bg);
      color: var(--text-main);
      font-family: var(--display);
      overflow-x: hidden;
    }

    .grain {
      position: fixed; inset: 0;
      background-image: url("https://grainy-gradients.vercel.app/noise.svg");
      opacity: 0.018; pointer-events: none; z-index: 999;
    }

    .frame-lines {
      position: fixed; inset: 0;
      border: 1px solid rgba(255,255,255,0.025);
      margin: 20px; pointer-events: none; z-index: 90;
    }

    #live-ticker {
      position: fixed;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 130;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 20px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: linear-gradient(180deg, rgba(18, 18, 20, 0.62), rgba(10, 10, 12, 0.48));
      backdrop-filter: blur(12px);
      font-family: var(--mono);
      font-size: 0.74rem;
      letter-spacing: 0.045em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.78);
      pointer-events: none;
      white-space: nowrap;
      box-shadow: 0 8px 24px rgba(0,0,0,0.24), inset 0 1px 0 rgba(255,255,255,0.05);
    }

    #ticker-text {
      color: #fff;
      font-weight: 800;
      letter-spacing: 0.04em;
    }

    #canvas-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      transform-origin: 50% 50%;
      will-change: transform, filter;
    }

    #transition-glow {
      position: fixed;
      inset: 0;
      z-index: 8;
      pointer-events: none;
      opacity: 0;
      background:
        radial-gradient(circle at 60% 30%, rgba(0, 219, 255, 0.26), rgba(0, 0, 0, 0) 40%),
        radial-gradient(circle at 30% 70%, rgba(255, 52, 139, 0.24), rgba(0, 0, 0, 0) 45%);
      mix-blend-mode: screen;
    }

    section {
      min-height: 100vh;
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      padding: 0 4rem;
      align-items: center;
      position: relative;
      z-index: 10;
      pointer-events: none;
    }

    .panel {
      grid-column: 1 / span 5;
      opacity: 0;
      transform: translate3d(-36px, 0, 0);
      filter: blur(7px);
      pointer-events: auto;
      will-change: transform, opacity, filter;
    }

    section:nth-of-type(even) .panel {
      grid-column: 8 / span 5;
      transform: translate3d(36px, 0, 0);
    }

    section.active .panel {
      opacity: 1;
      transform: translate3d(0, 0, 0);
      filter: blur(0px);
    }

    h1 {
      font-size: clamp(3rem, 10vw, 8rem);
      font-weight: 800;
      line-height: 0.9;
      text-transform: uppercase;
    }

    .artist-credit {
      margin-top: 0.8rem;
      margin-left: auto;
      margin-right: auto;
      font-family: var(--mono);
      font-size: clamp(0.72rem, 1.15vw, 0.92rem);
      letter-spacing: 0.22em;
      text-transform: uppercase;
      text-align: center;
      width: fit-content;
      color: rgba(226, 232, 238, 0.78);
      text-shadow: 0 1px 10px rgba(0, 0, 0, 0.32);
    }

    .title-line {
      display: block;
      overflow: hidden;
    }

    .title-char {
      display: inline-block;
      will-change: transform, opacity, filter;
    }

    .title-char-space {
      width: 0.35em;
    }

    h2 {
      font-size: 3.5rem;
      margin-bottom: 1rem;
    }

    p {
      max-width: 34ch;
      color: #aaa;
      line-height: 1.5;
    }

    .tech-note {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      margin-top: 2rem;
      font-family: var(--display);
      font-size: 0.75rem;
      padding: 0.5rem 1rem;
      border: 1px solid rgba(255,255,255,0.1);
      text-transform: none;
      letter-spacing: 0.01em;
      animation: techNoteFloat 1.6s ease-in-out infinite alternate;
    }

    .tech-note .down-arrows {
      display: inline-block;
      opacity: 0.88;
      animation: arrowPulse 1.2s ease-in-out infinite;
    }

    @keyframes techNoteFloat {
      from { transform: translateY(0px); }
      to { transform: translateY(4px); }
    }

    @keyframes arrowPulse {
      0%, 100% { transform: translateY(0px); opacity: 0.6; }
      50% { transform: translateY(4px); opacity: 1; }
    }

    .preview-rail {
      margin: 1.3rem auto 0;
      width: min(1040px, 92vw);
      display: flex;
      flex-wrap: nowrap;
      gap: 8px;
      pointer-events: auto;
      overflow-x: auto;
      overflow-y: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(5, 217, 232, 0.55) rgba(255,255,255,0.06);
    }

    .preview-link {
      display: block;
      flex: 0 0 94px;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 10px;
      padding: 10px 8px;
      text-decoration: none;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.015));
      transition:
        border-color var(--motion-fast) var(--motion-ease),
        transform var(--motion-fast) var(--motion-ease),
        background var(--motion-fast) var(--motion-ease);
      text-align: left;
    }

    .preview-link .num {
      display: block;
      font-family: var(--mono);
      font-size: 0.62rem;
      letter-spacing: 0.06em;
      color: rgba(255,255,255,0.72);
    }

    .preview-link .name {
      display: block;
      margin-top: 5px;
      font-size: 0.67rem;
      letter-spacing: 0.03em;
      color: rgba(255,255,255,0.86);
      text-transform: uppercase;
    }

    .preview-link:hover,
    .preview-link.active {
      border-color: rgba(255,255,255,0.18);
      background: linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.12));
      transform: translateY(-2px);
    }

    .study-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      margin: 0.8rem 0 0.45rem;
      font-family: var(--mono);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.58rem;
    }

    .study-tags span {
      border: 1px solid rgba(255,255,255,0.17);
      border-radius: 999px;
      padding: 4px 8px;
      color: rgba(255,255,255,0.77);
      background: rgba(255,255,255,0.04);
    }

    #scroll-indicator {
      --axis-x: 18px;
      position: fixed;
      left: 18px;
      top: 0;
      width: 112px;
      height: 100vh;
      z-index: 260;
      pointer-events: none;
    }

    #scroll-track {
      position: absolute;
      left: calc(var(--axis-x) - 3px);
      top: 0;
      width: 2px;
      background: rgba(255, 255, 255, 0.02); /* Almost invisible */
      height: 100%;
      border-radius: 999px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
    }

    #scroll-progress {
      box-shadow: 0 0 15px #7fe8ff, 0 0 30px rgba(127, 232, 255, 0.5);
      transition: height 0.2s ease-out;
      width: 100%;
      height: 0%;
      border-radius: inherit;
      background: #7fe8ff;
    }

    #progress-nav {
      position: absolute;
      inset: 0;
      pointer-events: auto;
      font-family: var(--mono);
    }

    #progress-nav a {
      position: absolute;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      color: #9f9f9f;
      text-decoration: none;
      font-size: 0.86rem;
      letter-spacing: 0.08em;
      opacity: 0.72;
      transition:
        opacity var(--motion-fast) var(--motion-ease),
        color var(--motion-fast) var(--motion-ease),
        transform var(--motion-fast) var(--motion-ease);
    }

    #progress-nav a .dot {
      position: absolute;
      left: var(--axis-x);
      top: 50%;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      box-sizing: border-box;
      border: 1px solid rgba(255,255,255,0.52);
      transform: translate(-50%, -50%);
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.6), rgba(255,255,255,0.2));
      transition:
        transform var(--motion-fast) var(--motion-ease),
        border-color var(--motion-fast) var(--motion-ease),
        background var(--motion-fast) var(--motion-ease),
        box-shadow var(--motion-fast) var(--motion-ease);
    }

    #progress-nav a .label {
      position: absolute;
      left: calc(var(--axis-x) + 24px);
      top: 50%;
      transform: translateY(-50%);
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(8, 11, 14, 0.36);
      backdrop-filter: blur(3px);
      transition: transform var(--motion-fast) var(--motion-ease);
      font-weight: 600;
      text-shadow: 0 1px 8px rgba(0,0,0,0.4);
    }

    #progress-nav a:hover {
      color: #fff;
      opacity: 1;
    }

    #progress-nav a.active {
      color: #fff;
      opacity: 1;
      transform: translateY(-50%);
    }

    #progress-nav a.active .dot {
      border-color: rgba(255,255,255,0.92);
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.95), rgba(255,255,255,0.45));
      box-shadow: 0 0 0 2px rgba(255,255,255,0.14), 0 0 12px rgba(255,255,255,0.2);
      transform: translate(-50%, -50%) scale(1.2);
    }

    #progress-nav a.active .label {
      transform: translateY(-50%);
    }

    #progress-nav a:hover .label {
      transform: translate(2px, -50%);
    }

    #progress-nav a .label {
      transform-origin: left center;
    }

    #progress-nav a.reached .dot {
      background: radial-gradient(circle at 35% 35%, rgba(148, 245, 255, 0.95), rgba(5, 217, 232, 0.45));
      border-color: rgba(5, 217, 232, 0.95);
      box-shadow: 0 0 0 3px rgba(5, 217, 232, 0.17), 0 0 18px rgba(5, 217, 232, 0.25);
    }

    #info-panel {
      position: fixed;
      top: 40px; right: 40px;
      font-family: "PS Times", "Times New Roman", Times, serif;
      font-size: 0.92rem;
      line-height: 1.45;
      color: rgba(232, 236, 240, 0.82);
      z-index: 100;
      text-align: right;
      will-change: transform, opacity;
    }

    body.light-artwork #info-panel {
      color: rgba(45, 45, 48, 0.9);
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.35);
    }

    .regenerate-btn {
      position: fixed;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 170;
      border: 1px solid rgba(130, 240, 255, 0.65);
      background: linear-gradient(180deg, rgba(15, 24, 32, 0.92), rgba(8, 13, 18, 0.9));
      color: rgba(238, 251, 255, 0.98);
      font-family: var(--mono);
      font-size: 0.74rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      border-radius: 999px;
      padding: 10px 16px;
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transition:
        opacity var(--motion-fast) var(--motion-ease),
        transform var(--motion-fast) var(--motion-ease),
        border-color var(--motion-fast) var(--motion-ease),
        background var(--motion-fast) var(--motion-ease),
        box-shadow var(--motion-fast) var(--motion-ease);
      backdrop-filter: blur(8px);
      width: 230px;
      text-align: center;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.38), inset 0 0 0 1px rgba(170, 245, 255, 0.2);
      text-shadow: 0 1px 8px rgba(0, 0, 0, 0.45);
    }

    .regenerate-btn.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(-50%);
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.42), inset 0 0 0 1px rgba(170, 245, 255, 0.24);
    }

    .regenerate-btn:hover {
      border-color: rgba(120, 245, 255, 0.95);
      background: linear-gradient(180deg, rgba(26, 52, 66, 0.95), rgba(10, 22, 30, 0.93));
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.44), 0 0 0 2px rgba(120, 245, 255, 0.18);
    }

    .preview-link:focus-visible,
    #progress-nav a:focus-visible,
    .regenerate-btn:focus-visible {
      outline: 2px solid rgba(127, 232, 255, 0.95);
      outline-offset: 2px;
      box-shadow: 0 0 0 3px rgba(2, 8, 12, 0.72);
    }

    @media (prefers-reduced-motion: reduce) {
      .tech-note,
      .tech-note .down-arrows {
        animation: none;
      }

      .preview-link:hover,
      .preview-link.active {
        transform: none;
      }

      #progress-nav a:hover .label {
        transform: translateY(-50%);
      }

      #transition-glow {
        display: none;
      }
    }

    .highlight { color: #fff; font-weight: bold; }
    body.light-artwork .highlight { color: #111; }
    body.light-artwork .artist-credit { color: rgba(20, 24, 30, 0.72); text-shadow: none; }

    @media (max-width: 900px) {
      section { padding: 0 1.25rem; }
      .panel, section:nth-of-type(even) .panel { grid-column: 1 / -1; }
      h2 { font-size: 2.2rem; }
      #live-ticker { top: 18px; gap: 9px; padding: 8px 12px; font-size: 0.6rem; }
      .preview-rail { width: 100%; }
      .preview-link { padding: 8px 7px; }
      .regenerate-btn { right: 16px; width: 180px; font-size: 0.63rem; padding: 8px 12px; }
      #scroll-indicator { --axis-x: 12px; width: 72px; left: 8px; }
      #progress-nav a { font-size: 0.66rem; }
      #progress-nav a .dot { width: 8px; height: 8px; }
      #progress-nav a .label { left: calc(var(--axis-x) + 16px); }
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
</head>

<body>

  <div class="grain"></div>
  <div class="frame-lines"></div>
  <div id="live-ticker" aria-live="polite">
    <span id="ticker-text">Front Page</span>
  </div>
  <div id="transition-glow"></div>

  <div id="canvas-container"></div>

  <div id="info-panel">
    <div id="caption">SYSTEM_IDLE // READY</div>
  </div>

  <div id="scroll-indicator">
    <div id="scroll-track">
      <div id="scroll-progress"></div>
    </div>
    <nav id="progress-nav" aria-label="Artwork sections"></nav>
  </div>

  <section class="active" id="intro">
    <div class="panel" style="grid-column: 1 / -1; text-align:center;">
      <h1 id="intro-title">SYNTHETIC<br>MOTIONS</h1>
      <p class="artist-credit">John Smith</p>
      <div class="tech-note"><span class="down-arrows" aria-hidden="true">↓</span> Scroll to initialize <span class="down-arrows" aria-hidden="true">↓</span></div>
      <div class="preview-rail" aria-label="Quick jump to studies">
        <a class="preview-link" href="#s1" data-target="s1"><span class="num">01</span><span class="name">Rose</span></a>
        <a class="preview-link" href="#s2" data-target="s2"><span class="num">02</span><span class="name">Wave</span></a>
        <a class="preview-link" href="#s3" data-target="s3"><span class="num">03</span><span class="name">Loom</span></a>
        <a class="preview-link" href="#s4" data-target="s4"><span class="num">04</span><span class="name">Quantum</span></a>
        <a class="preview-link" href="#s5" data-target="s5"><span class="num">05</span><span class="name">Rects</span></a>
        <a class="preview-link" href="#s6" data-target="s6"><span class="num">06</span><span class="name">Constellation</span></a>
        <a class="preview-link" href="#s7" data-target="s7"><span class="num">07</span><span class="name">Molnar</span></a>
        <a class="preview-link" href="#s8" data-target="s8"><span class="num">08</span><span class="name">Scribble</span></a>
        <a class="preview-link" href="#s9" data-target="s9"><span class="num">09</span><span class="name">Ribbon</span></a>
        <a class="preview-link" href="#s10" data-target="s10"><span class="num">10</span><span class="name">Fractured Web</span></a>
      </div>
    </div>
  </section>

  <section id="s1" data-mode="1" data-label="01 // Rose" data-meta="Polar geometry • mouse mapped"></section>
  <section id="s2" data-mode="2" data-label="02 // Wave" data-meta="Kinetic harmonics • distance reactive"></section>
  <section id="s3" data-mode="3" data-label="03 // Loom" data-meta="Recursive weaving • density control"></section>
  <section id="s4" data-mode="4" data-label="04 // Quantum" data-meta="Lissajous orbit • trail memory"></section>
  <section id="s5" data-mode="5" data-label="05 // Flying Rectangles" data-meta="Painterly drift • layered depth"></section>
  <section id="s6" data-mode="6" data-label="06 // Constellation" data-meta="Network proximity • luminous segments"></section>
  <section id="s7" data-mode="7" data-label="07 // Molnar Study" data-meta="Structured quadrilaterals • click to regenerate"></section>
  <section id="s8" data-mode="8" data-label="08 // Scribble Grid" data-meta="Rotated line stacks • button + mouse reactive"></section>
  <section id="s9" data-mode="9" data-label="09 // Ribbon Surface" data-meta="Parametric WEBGL ribbon • orbit + color drift"></section>
  <section id="s10" data-mode="10" data-label="10 // Fractured Web" data-meta="Geometric facets • click to regenerate"></section>
  <button id="regenerate-molnar-btn" class="regenerate-btn" type="button">Regenerate Molnar Study</button>
  <button id="regenerate-art-btn" class="regenerate-btn" type="button">Regenerate Scribble Grid</button>

  <script src="sketch.js"></script>
  <script>
    gsap.registerPlugin(ScrollTrigger);

    const sections = gsap.utils.toArray("section");
    const artSections = gsap.utils.toArray("section[data-mode]");
    const progressEl = document.getElementById("scroll-progress");
    const progressTrack = document.getElementById("scroll-track");
    const navContainer = document.getElementById("progress-nav");
    const glow = document.getElementById("transition-glow");
    const tickerText = document.getElementById("ticker-text");
    const previewLinks = gsap.utils.toArray(".preview-link");
    const regenerateBtn = document.getElementById("regenerate-art-btn");
    const regenerateMolnarBtn = document.getElementById("regenerate-molnar-btn");
    const introSection = document.getElementById("intro");
    const introTitle = document.getElementById("intro-title");
    const reducedMotionQuery = window.matchMedia("(prefers-reduced-motion: reduce)");

    let activeMode = 0;
    let pulseTween;
    let introTitleFloatTween = null;
    let previewFloatTween = null;
    let progressAmbientTween = null;
    let activeDotTween = null;
    let introTitleChars = [];
    const navLinks = [];
    const prefersReducedMotion = () => reducedMotionQuery.matches;
    const MOTION = {
      fast: prefersReducedMotion() ? 0.12 : 0.3,
      medium: prefersReducedMotion() ? 0.2 : 0.65,
      slow: prefersReducedMotion() ? 0.25 : 1.05,
      easeOut: "power2.out",
      easeInOut: "power2.inOut"
    };
    if (window.setReducedMotion) {
      window.setReducedMotion(prefersReducedMotion());
    }

    function splitIntroTitleChars() {
      if (!introTitle || introTitle.dataset.splitReady === "true") return;
      const lines = introTitle.innerHTML
        .split(/<br\s*\/?>/i)
        .map(line => line.trim())
        .filter(Boolean);

      const splitMarkup = lines.map(line => {
        const chars = Array.from(line).map(char => {
          if (char === " ") {
            return "<span class=\"title-char title-char-space\" aria-hidden=\"true\">&nbsp;</span>";
          }
          return `<span class="title-char" aria-hidden="true">${char}</span>`;
        }).join("");
        return `<span class="title-line">${chars}</span>`;
      }).join("");

      introTitle.setAttribute("aria-label", lines.join(" "));
      introTitle.innerHTML = splitMarkup;
      introTitle.dataset.splitReady = "true";
      introTitleChars = gsap.utils.toArray("#intro-title .title-char");
    }

    function animateIntroTitle() {
      if (!introTitle || introTitleChars.length === 0) return;
      if (introTitleFloatTween) {
        introTitleFloatTween.kill();
        introTitleFloatTween = null;
      }

      if (prefersReducedMotion()) {
        gsap.set(introTitleChars, { opacity: 1, yPercent: 0, rotateX: 0, filter: "none" });
        gsap.set(introTitle, { yPercent: 0 });
        return;
      }

      gsap.set(introTitleChars, { transformOrigin: "50% 100%" });
      gsap.fromTo(
        introTitleChars,
        { yPercent: 120, opacity: 0, rotateX: -80, filter: "blur(6px)" },
        {
          yPercent: 0,
          opacity: 1,
          rotateX: 0,
          filter: "blur(0px)",
          duration: 0.8,
          ease: "power3.out",
          stagger: 0.03
        }
      );

      introTitleFloatTween = gsap.to(introTitle, {
        yPercent: -2,
        duration: 2.6,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true
      });
    }

    function stopPreviewRailAnimation() {
      if (previewFloatTween) {
        previewFloatTween.kill();
        previewFloatTween = null;
      }
      if (previewLinks.length) {
        gsap.killTweensOf(previewLinks);
        gsap.set(previewLinks, { autoAlpha: 1, y: 0, scale: 1, filter: "none" });
      }
    }

    function animatePreviewRail() {
      if (!previewLinks.length) return;
      stopPreviewRailAnimation();

      if (prefersReducedMotion()) {
        return;
      }

      gsap.fromTo(
        previewLinks,
        { autoAlpha: 0, y: 18, scale: 0.98, filter: "blur(4px)" },
        {
          autoAlpha: 1,
          y: 0,
          scale: 1,
          filter: "blur(0px)",
          duration: 0.52,
          ease: "power2.out",
          stagger: 0.045
        }
      );

      previewFloatTween = gsap.to(previewLinks, {
        y: -3,
        duration: 1.9,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
        delay: 0.6,
        stagger: { each: 0.08, from: "center" }
      });
    }

    function getProgressDots() {
      return navLinks
        .map(link => link.querySelector(".dot"))
        .filter(Boolean);
    }

    function getProgressLabels() {
      return navLinks
        .map(link => link.querySelector(".label"))
        .filter(Boolean);
    }

    function updateActiveDotPulse() {
      if (activeDotTween) {
        activeDotTween.kill();
        activeDotTween = null;
      }

      const dots = getProgressDots();
      dots.forEach(dot => gsap.set(dot, { clearProps: "scale" }));
      if (prefersReducedMotion()) return;

      const activeLink = navLinks.find(link => link.classList.contains("active"));
      if (!activeLink) return;
      const activeDot = activeLink.querySelector(".dot");
      if (!activeDot) return;

      activeDotTween = gsap.to(activeDot, {
        scale: 1.32,
        duration: 0.8,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true
      });
    }

    function stopProgressIndicatorAnimation() {
      if (progressAmbientTween) {
        progressAmbientTween.kill();
        progressAmbientTween = null;
      }
      if (activeDotTween) {
        activeDotTween.kill();
        activeDotTween = null;
      }

      gsap.killTweensOf(progressTrack);
      gsap.killTweensOf(progressEl);
      gsap.killTweensOf(navLinks);
      gsap.killTweensOf(getProgressDots());
      gsap.killTweensOf(getProgressLabels());

      if (progressTrack) {
        gsap.set(progressTrack, { scaleY: 1, autoAlpha: 1, transformOrigin: "50% 0%" });
      }
      if (progressEl) {
        gsap.set(progressEl, { clearProps: "boxShadow,opacity,visibility,transform" });
      }
      if (navLinks.length) {
        gsap.set(navLinks, { clearProps: "x,opacity,visibility,transform" });
      }
      const dots = getProgressDots();
      if (dots.length) {
        gsap.set(dots, { clearProps: "scale,opacity,visibility,transform" });
      }
      const labels = getProgressLabels();
      if (labels.length) {
        gsap.set(labels, { clearProps: "x,opacity,visibility,transform" });
      }
    }

    function animateProgressIndicator() {
      if (!navLinks.length) return;
      stopProgressIndicatorAnimation();
      if (prefersReducedMotion()) return;

      const dots = getProgressDots();
      const labels = getProgressLabels();

      if (progressTrack) {
        gsap.set(progressTrack, { transformOrigin: "50% 0%" });
        gsap.fromTo(
          progressTrack,
          { scaleY: 0, autoAlpha: 0.2 },
          { scaleY: 1, autoAlpha: 1, duration: 0.95, ease: "power2.out" }
        );
      }

      gsap.fromTo(
        navLinks,
        { x: -14, autoAlpha: 0 },
        {
          x: 0,
          autoAlpha: 0.72,
          duration: 0.46,
          ease: "power2.out",
          stagger: 0.05,
          delay: 0.2,
          onComplete: () => gsap.set(navLinks, { clearProps: "opacity,visibility,transform" })
        }
      );

      if (dots.length) {
        gsap.fromTo(
          dots,
          { scale: 0.45, autoAlpha: 0.2 },
          {
            scale: 1,
            autoAlpha: 1,
            duration: 0.42,
            ease: "back.out(1.8)",
            stagger: 0.05,
            delay: 0.22,
            onComplete: () => gsap.set(dots, { clearProps: "opacity,visibility,transform" })
          }
        );
      }

      if (labels.length) {
        gsap.fromTo(
          labels,
          { x: -6, autoAlpha: 0.2 },
          {
            x: 0,
            autoAlpha: 1,
            duration: 0.45,
            ease: "power2.out",
            stagger: 0.05,
            delay: 0.24,
            onComplete: () => gsap.set(labels, { clearProps: "opacity,visibility,transform" })
          }
        );
      }

      progressAmbientTween = gsap.to(progressEl, {
        boxShadow: "0 0 24px #7fe8ff, 0 0 36px rgba(127, 232, 255, 0.58)",
        duration: 1.8,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true
      });

      updateActiveDotPulse();
    }

    splitIntroTitleChars();
    animateIntroTitle();
    animatePreviewRail();

    artSections.forEach((section, index) => {
      const link = document.createElement("a");
      link.href = `#${section.id}`;
      const ratio = (index + 1) / (artSections.length + 1);
      link.style.top = `${ratio * 100}%`;
      link.dataset.progress = String(ratio);
      link.setAttribute("aria-label", section.dataset.label || `Study ${index + 1}`);

      const dot = document.createElement("span");
      dot.className = "dot";
      dot.setAttribute("aria-hidden", "true");

      const label = document.createElement("span");
      label.className = "label";
      label.textContent = String(index + 1).padStart(2, "0");

      link.appendChild(dot);
      link.appendChild(label);
      navContainer.appendChild(link);
      navLinks.push(link);
    });
    animateProgressIndicator();

    function setActiveNav(id) {
      navLinks.forEach(link => {
        const isActive = link.getAttribute("href") === `#${id}`;
        link.classList.toggle("active", isActive);
      });
      updateActiveDotPulse();
    }

    function setArtworkContrastMode(modeNumber) {
      document.body.classList.toggle("light-artwork", modeNumber === 7 || modeNumber === 8 || modeNumber === 10);
    }

    function setActivePreview(id) {
      previewLinks.forEach(link => {
        const isActive = link.dataset.target === id;
        link.classList.toggle("active", isActive);
      });
    }

    function updateTicker(section) {
      if (!section || !tickerText) return;
      tickerText.textContent = section.dataset.label || section.id || "Live";
    }

    function setReachedDots(percent) {
      navLinks.forEach(link => {
        const stop = Number(link.dataset.progress || 0);
        link.classList.toggle("reached", percent >= stop);
      });
    }

    function runModeTransitionFx() {
      const reduced = prefersReducedMotion();
      gsap.fromTo(
        "#canvas-container",
        reduced
          ? { scale: 1, filter: "none" }
          : { scale: 1.03, filter: "blur(10px) saturate(1.25)" },
        {
          scale: 1,
          filter: "none",
          duration: MOTION.slow,
          ease: MOTION.easeOut
        }
      );
    }

    function activateSection(section) {
      const newMode = Number(section.dataset.mode);

      if (!Number.isNaN(newMode) && newMode !== activeMode) {
        changeMode(newMode);
        activeMode = newMode;
        setArtworkContrastMode(activeMode);
        runModeTransitionFx();
      }

      sections.forEach(s => s.classList.remove("active"));
      section.classList.add("active");
      stopPreviewRailAnimation();
      setActiveNav(section.id);
      setActivePreview(section.id);
      updateTicker(section);
      if (regenerateBtn) {
        regenerateBtn.classList.toggle("visible", section.id === "s8");
      }
      if (regenerateMolnarBtn) {
        regenerateMolnarBtn.classList.toggle("visible", section.id === "s7");
      }
    }

    function getCurrentSectionIndex() {
      const activeIdx = sections.findIndex(section => section.classList.contains("active"));
      if (activeIdx >= 0) return activeIdx;

      let closestIdx = 0;
      let closestDist = Infinity;
      const y = window.scrollY;
      sections.forEach((section, idx) => {
        const dist = Math.abs(section.offsetTop - y);
        if (dist < closestDist) {
          closestDist = dist;
          closestIdx = idx;
        }
      });
      return closestIdx;
    }

    function scrollToSectionIndex(index) {
      const bounded = gsap.utils.clamp(0, sections.length - 1, index);
      const targetTop = sections[bounded].offsetTop;
      window.scrollTo({ top: targetTop, behavior: "smooth" });
    }

    sections.forEach((section, i) => {
      const panel = section.querySelector(".panel");
      if (!panel) return;

      const baseX = i % 2 === 0 ? -60 : 60;
      if (prefersReducedMotion()) {
        gsap.fromTo(
          panel,
          { autoAlpha: 0 },
          {
            autoAlpha: 1,
            duration: MOTION.fast,
            ease: MOTION.easeOut,
            scrollTrigger: {
              trigger: section,
              start: "top 80%",
              toggleActions: "play none none reverse"
            }
          }
        );
      } else {
        gsap.fromTo(
          panel,
          { autoAlpha: 0, x: baseX, y: 16, filter: "blur(8px)" },
          {
            autoAlpha: 1,
            x: 0,
            y: 0,
            filter: "blur(0px)",
            ease: MOTION.easeOut,
            scrollTrigger: {
              trigger: section,
              start: "top 80%",
              end: "top 45%",
              scrub: MOTION.medium
            }
          }
        );
      }
    });

    artSections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: "top center",
        end: "bottom center",
        onEnter: () => activateSection(section),
        onEnterBack: () => activateSection(section)
      });
    });

    if (introSection) {
      ScrollTrigger.create({
        trigger: introSection,
        start: "top center",
        end: "bottom center",
        onEnter: () => {
          sections.forEach(s => s.classList.remove("active"));
          introSection.classList.add("active");
          animatePreviewRail();
          setActiveNav("");
          setActivePreview("");
          updateTicker({ dataset: { label: "Front Page" }, id: "intro" });
          if (regenerateBtn) regenerateBtn.classList.remove("visible");
          if (regenerateMolnarBtn) regenerateMolnarBtn.classList.remove("visible");
          if (activeMode !== 0) {
            changeMode(0);
            activeMode = 0;
            setArtworkContrastMode(activeMode);
            runModeTransitionFx();
          }
        },
        onEnterBack: () => {
          sections.forEach(s => s.classList.remove("active"));
          introSection.classList.add("active");
          animatePreviewRail();
          setActiveNav("");
          setActivePreview("");
          updateTicker({ dataset: { label: "Front Page" }, id: "intro" });
          if (regenerateBtn) regenerateBtn.classList.remove("visible");
          if (regenerateMolnarBtn) regenerateMolnarBtn.classList.remove("visible");
          if (activeMode !== 0) {
            changeMode(0);
            activeMode = 0;
            setArtworkContrastMode(activeMode);
            runModeTransitionFx();
          }
        }
      });
    }

    ScrollTrigger.create({
      start: 0,
      end: "max",
      onUpdate: self => {
        const percent = self.progress;
        progressEl.style.height = percent * 100 + "%";
        setReachedDots(percent);
        if (window.setScrollProgress) {
          window.setScrollProgress(percent);
        }
      }
    });

    if (!prefersReducedMotion()) {
      ScrollTrigger.create({
        snap: {
          snapTo: (value) => {
            const currentIdx = getCurrentSectionIndex();
            const rawIdx = Math.round(value * (sections.length - 1));
            const boundedIdx = gsap.utils.clamp(currentIdx - 1, currentIdx + 1, rawIdx);
            const steps = sections.length - 1;
            return boundedIdx / steps;
          },
          duration: MOTION.medium,
          ease: MOTION.easeInOut
        }
      });
    }

    reducedMotionQuery.addEventListener("change", (event) => {
      if (window.setReducedMotion) {
        window.setReducedMotion(event.matches);
      }
      animateIntroTitle();
      animateProgressIndicator();
      if (introSection && introSection.classList.contains("active")) {
        animatePreviewRail();
      } else {
        stopPreviewRailAnimation();
      }
      ScrollTrigger.refresh();
    });

    setActiveNav("");
    setActivePreview("");
    setReachedDots(0);
    updateTicker({ dataset: { label: "Front Page" }, id: "intro" });
    if (regenerateBtn) {
      regenerateBtn.classList.remove("visible");
      regenerateBtn.addEventListener("click", () => {
        if (window.regenerateScribbleGrid) {
          window.regenerateScribbleGrid();
        }
      });
    }
    if (regenerateMolnarBtn) {
      regenerateMolnarBtn.classList.remove("visible");
      regenerateMolnarBtn.addEventListener("click", () => {
        if (window.regenerateMolnarStudy) {
          window.regenerateMolnarStudy();
        }
      });
    }
    changeMode(0);
    setArtworkContrastMode(0);
    runModeTransitionFx();
  </script>

</body>
</html>
